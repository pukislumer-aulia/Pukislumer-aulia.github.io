<!-- ========== PART 1: HEAD & HEADER ========== -->
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pukis Lumer Aulia</title>
  <meta name="description" content="Pukis lumer terenak di Padang Panjang" />
  <link rel="icon" href="assets/images/favicon.ico" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    :root{--brand:#002147;--accent:#d6336c;--muted:#666;}
    body{font-family:Arial, sans-serif;background:#fff8f8;color:#222;margin:0;padding:16px;}
    .container{max-width:980px;margin:0 auto;}
    h1{color:var(--accent);margin:6px 0;}
    .responsive-img{max-width:100%;height:auto;border-radius:8px}
    /* small utilities */
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .card{background:#fff;padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
    /* price badge */
    .price-badge{font-weight:800;color:var(--accent)}
    /* popup nota (keperluan optional) */
    #notaContainer{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;z-index:9999}
    #notaBox{background:#fff;padding:16px;border-radius:10px;max-width:600px;width:95%}
  </style>
</head>
<body>
  <div class="container">
    <!-- Promo / Header -->
    <marquee style="background:#fff8ea;padding:8px;border-radius:8px;color:var(--brand)">Promo: Tukarkan 15 kupon dapat 1 box gratis! </marquee>
    <h1>PUKIS LUMER AULIA</h1>
    <p style="margin-top:0;color:var(--brand)"><strong>Pasar Kuliner Padang Panjang â€” Jam Operasional: 16.00â€“23.59 WIB</strong></p>

    <!-- Galeri ringkas -->
    <div class="row" style="margin-bottom:14px;">
      <img src="assets/images/pukis1.jpg" alt="pukis1" class="responsive-img" style="max-width:200px">
      <img src="assets/images/pukis2.jpg" alt="pukis2" class="responsive-img" style="max-width:200px">
      <img src="assets/images/pukis3.jpg" alt="pukis3" class="responsive-img" style="max-width:200px">
    </div>
  <!-- part2 akan dimulai di bawah -->
    <!-- ========== PART 2: FORM PEMESANAN (ULTRA) ========== -->
<section id="order" class="card" style="margin-bottom:14px;">
  <h2>Pemesanan Pukis Lumer Aulia (Form Ultra)</h2>

  <form id="formUltra">
    <label>Nama Pemesan:
      <input type="text" id="ultra_nama" required style="width:100%;padding:8px;margin-top:6px;border-radius:6px;border:1px solid #ccc">
    </label>

    <label>Nomor WhatsApp (contoh 0812...):
      <input type="text" id="ultra_wa" placeholder="0812..." style="width:100%;padding:8px;margin-top:6px;border-radius:6px;border:1px solid #ccc">
    </label>

    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;">
      <div style="flex:1">
        <label>Jenis Pukis:
          <select id="ultra_jenis" required style="width:100%;padding:8px;border-radius:6px;border:1px solid #ccc">
            <option value="">-- Pilih Jenis --</option>
            <option value="Original">Original</option>
            <option value="Pandan">Pandan</option>
          </select>
        </label>
      </div>

      <div style="width:140px">
        <label>Isi per Box:
          <select id="ultra_isi" required style="width:100%;padding:8px;border-radius:6px;border:1px solid #ccc">
            <option value="5">5 pcs</option>
            <option value="10">10 pcs</option>
          </select>
        </label>
      </div>

      <div style="width:140px">
        <label>Jumlah Box:
          <input type="number" id="ultra_jumlah" value="1" min="1" max="10" style="width:100%;padding:8px;border-radius:6px;border:1px solid #ccc" required>
        </label>
      </div>
    </div>

    <div style="margin-top:8px;">
      <label>Topping Mode:</label>
      <label><input type="radio" name="ultra_topping" value="non" checked> Non Topping</label>
      <label><input type="radio" name="ultra_topping" value="single"> Single Topping</label>
      <label><input type="radio" name="ultra_topping" value="double"> Double Topping</label>
    </div>

    <!-- single topping group (hidden by default) -->
    <div id="ultra_singleGroup" style="display:none;margin-top:8px;">
      <div style="font-weight:bold">Pilih Rasa (Single) â€” maksimal 5</div>
      <label><input type="checkbox" class="ultra_single" value="Coklat"> Coklat</label>
      <label><input type="checkbox" class="ultra_single" value="Cappucino"> Cappucino</label>
      <label><input type="checkbox" class="ultra_single" value="Vanilla"> Vanilla</label>
      <label><input type="checkbox" class="ultra_single" value="Stroberi"> Stroberi</label>
      <label><input type="checkbox" class="ultra_single" value="Tiramisu"> Tiramisu</label>
    </div>

    <!-- double topping group (hidden by default) -->
    <div id="ultra_doubleGroup" style="display:none;margin-top:8px;">
      <div style="font-weight:bold">Pilih Taburan (Double) â€” maksimal 5</div>
      <label><input type="checkbox" class="ultra_double" value="Meses"> Meses</label>
      <label><input type="checkbox" class="ultra_double" value="Keju"> Keju</label>
      <label><input type="checkbox" class="ultra_double" value="Kacang"> Kacang</label>
      <label><input type="checkbox" class="ultra_double" value="Choco Chip"> Choco Chip</label>
      <label><input type="checkbox" class="ultra_double" value="Oreo"> Oreo</label>
    </div>

    <!-- Price summary -->
    <div id="ultra_priceSummary" style="margin-top:12px;padding:10px;background:#fff8ea;border-radius:8px;">
      <div style="display:flex;justify-content:space-between"><div>Harga per Box:</div><div id="ultra_pricePerBox" class="price-badge">Rp0</div></div>
      <div style="display:flex;justify-content:space-between"><div>Subtotal:</div><div id="ultra_subTotal">Rp0</div></div>
      <div style="display:flex;justify-content:space-between;font-weight:bold;margin-top:8px;"><div>Total Bayar:</div><div id="ultra_grandTotal" class="price-badge">Rp0</div></div>
    </div>

    <button type="submit" style="margin-top:12px;padding:10px 14px;border-radius:8px;background:var(--accent);color:#fff;border:0">Checkout â€” Buat Nota & Kirim WA</button>
  </form>
</section>

<!-- optional small nota popup container (will not replace PDF) -->
<div id="notaContainer" style="display:none;align-items:center;justify-content:center;position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:9999">
  <div id="notaBox" style="background:#fff;padding:14px;border-radius:10px;max-width:520px;width:92%"></div>
</div>
<!-- ========== PART 3: jsPDF LIB + PDF GENERATOR ========== -->
<!-- 1) Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<!-- 2) PDF function (sederhana, teks saja) -->
<script>
const { jsPDF } = window.jspdf;

function formatRp(n){ return "Rp " + Number(n).toLocaleString("id-ID"); }

function generateInvoiceID(){
  const d = new Date();
  const stamp = String(d.getTime()).slice(-6);
  return `PLA-${d.getFullYear()}${String(d.getMonth()+1).padStart(2,'0')}${String(d.getDate()).padStart(2,'0')}-${stamp}`;
}

/**
 * order object fields:
 * invoiceID, createdAt, nama, buyerWA, jenis, toppingMode, isiPerBox, jumlahBox,
 * pricePerBox, subTotal, grandTotal, singleList, doubleList, alamat
 */
function createAndDownloadPDF(order){
  try{
    const doc = new jsPDF({ unit:'pt', format:'A4' });
    let y = 40;
    const left = 40;
    doc.setFontSize(14); doc.setFont(undefined,'bold'); doc.text("PUKIS LUMER AULIA", left, y);
    y += 18;
    doc.setFontSize(10); doc.setFont(undefined,'normal');
    doc.text("Pasar Kuliner Padang Panjang", left, y); y += 16;
    doc.text(`Invoice: ${order.invoiceID}`, left, y); doc.text(`Tanggal: ${new Date(order.createdAt).toLocaleString()}`, 340, y); y += 18;
    doc.text(`Nama: ${order.nama}`, left, y); y += 14;
    if(order.buyerWA) { doc.text(`WA: ${order.buyerWA}`, left, y); y += 14; }
    if(order.alamat) { doc.text(`Alamat: ${order.alamat}`, left, y); y += 18; }

    doc.setLineWidth(0.5); doc.line(left, y, 555, y); y += 12;
    doc.setFont(undefined,'bold'); doc.text("DETAIL PESANAN", left, y); y += 14;
    doc.setFont(undefined,'normal');
    doc.text(`Jenis: ${order.jenis}`, left, y); y += 12;
    doc.text(`Topping Mode: ${order.toppingMode}`, left, y); y += 12;
    if(order.singleList) { doc.text(`Rasa: ${order.singleList}`, left, y); y += 12; }
    if(order.doubleList) { doc.text(`Taburan: ${order.doubleList}`, left, y); y += 12; }
    doc.text(`Isi/Box: ${order.isiPerBox} pcs`, left, y); y += 12;
    doc.text(`Jumlah Box: ${order.jumlahBox}`, left, y); y += 12;

    y += 8; doc.line(left, y, 555, y); y += 10;
    doc.setFont(undefined,'bold'); doc.text("Rincian Harga", left, y); y += 14;
    doc.setFont(undefined,'normal');
    doc.text(`Harga per Box: ${formatRp(order.pricePerBox)}`, left, y); y += 12;
    doc.text(`Subtotal: ${formatRp(order.subTotal)}`, left, y); y += 12;
    if(order.discount && order.discount>0){ doc.text(`Diskon: -${formatRp(order.discount)}`, left, y); y += 12; }
    doc.setFont(undefined,'bold'); doc.text(`TOTAL BAYAR: ${formatRp(order.grandTotal)}`, left, y); y += 18;

    doc.setFontSize(10); doc.setFont(undefined,'normal');
    doc.text("Terima kasih telah memesan Pukis Lumer Aulia!", left, y); y += 12;
    doc.text("Simpan PDF ini sebagai bukti pesanan.", left, y);

    const filename = `${order.invoiceID}.pdf`;
    doc.save(filename);
    return true;
  } catch(err){
    console.error("PDF error:", err);
    return false;
  }
}
  </script>

<!-- ========== PART 4: LOGIKA HARGA, UI TOPPING, SUBMIT ========== -->
<script>
/* Harga sesuai konfirmasi */
const harga = {
  Original: {
    5: { non:10000, single:13000, double:15000 },
    10:{ non:18000, single:25000, double:28000 }
  },
  Pandan: {
    5: { non:13000, single:15000, double:18000 },
    10:{ non:25000, single:28000, double:32000 }
  }
};

/* helper */
function getSelectedValues(selector){
  return Array.from(document.querySelectorAll(selector+':checked')).map(i=>i.value);
}

/* Update UI: show/hide topping groups and recalc */
function updateToppingUI(){
  const mode = document.querySelector('input[name="ultra_topping"]:checked').value;
  document.getElementById('ultra_singleGroup').style.display = (mode === 'single' || mode === 'double') ? 'block' : 'none';
  document.getElementById('ultra_doubleGroup').style.display = (mode === 'double') ? 'block' : 'none';
  calcPrice();
}

/* Calc price and update summary */
function calcPrice(){
  const jenis = document.getElementById('ultra_jenis').value;
  const isi = Number(document.getElementById('ultra_isi').value);
  const jumlah = Number(document.getElementById('ultra_jumlah').value) || 1;
  const mode = document.querySelector('input[name="ultra_topping"]:checked').value;

  if(!jenis || !isi || !mode) {
    document.getElementById('ultra_pricePerBox').innerText = 'Rp0';
    document.getElementById('ultra_subTotal').innerText = 'Rp0';
    document.getElementById('ultra_grandTotal').innerText = 'Rp0';
    return;
  }

  const key = (mode === 'non') ? 'non' : (mode === 'single') ? 'single' : 'double';
  const pricePerBox = (harga[jenis] && harga[jenis][isi] && harga[jenis][isi][key]) ? harga[jenis][isi][key] : 0;
  const sub = pricePerBox * jumlah;
  document.getElementById('ultra_pricePerBox').innerText = formatRp(pricePerBox);
  document.getElementById('ultra_subTotal').innerText = formatRp(sub);
  document.getElementById('ultra_grandTotal').innerText = formatRp(sub);
  return { pricePerBox, sub };
}

/* Enforce max 5 selection for single/double */
function enforceMaxCheckboxes(selector, max=5){
  const els = Array.from(document.querySelectorAll(selector));
  els.forEach(el=>{
    el.addEventListener('change', ()=>{
      const checked = els.filter(i=>i.checked);
      if(checked.length > max){
        el.checked = false;
        alert(`Maksimal ${max} pilihan.`);
      }
    });
  });
}

/* Attach listeners on load */
window.addEventListener('load', ()=>{
  // show/hide topping based on radio
  document.querySelectorAll('input[name="ultra_topping"]').forEach(r => r.addEventListener('change', updateToppingUI));
  // recalc on changes
  ['ultra_jenis','ultra_isi','ultra_jumlah'].forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.addEventListener('change', calcPrice);
  });
  // enforce max choices
  enforceMaxCheckboxes('.ultra_single',5);
  enforceMaxCheckboxes('.ultra_double',5);

  // also recalc at start
  calcPrice();
});

/* Form submit handler */
document.getElementById('formUltra').addEventListener('submit', function(e){
  e.preventDefault();

  const nama = document.getElementById('ultra_nama').value.trim();
  let wa = document.getElementById('ultra_wa').value.trim();
  const jenis = document.getElementById('ultra_jenis').value;
  const isi = Number(document.getElementById('ultra_isi').value);
  const jumlah = Number(document.getElementById('ultra_jumlah').value) || 1;
  const toppingMode = document.querySelector('input[name="ultra_topping"]:checked').value;
  const singleList = getSelectedValues('.ultra_single').join(', ');
  const doubleList = getSelectedValues('.ultra_double').join(', ');
  const alamat = (document.getElementById('alamat') && document.getElementById('alamat').value.trim()) || '';

  // validation
  if(!nama){ alert("Isi nama"); return; }
  if(!jenis){ alert("Pilih jenis"); return; }
  if(!isi){ alert("Pilih isi per box"); return; }
  if(!jumlah || jumlah < 1){ alert("Jumlah minimal 1"); return; }

  // price calc
  const key = (toppingMode === 'non') ? 'non' : (toppingMode === 'single') ? 'single' : 'double';
  const pricePerBox = (harga[jenis] && harga[jenis][isi] && harga[jenis][isi][key]) ? harga[jenis][isi][key] : 0;
  const subTotal = pricePerBox * jumlah;
  const grandTotal = subTotal;

  // invoice & order object
  const order = {
    invoiceID: generateInvoiceID(),
    createdAt: new Date().toISOString(),
    nama, buyerWA: wa, jenis, toppingMode, isiPerBox: isi, jumlahBox: jumlah,
    pricePerBox, subTotal, grandTotal, singleList, doubleList, alamat
  };

  // create PDF and force download
  const okPdf = createAndDownloadPDF(order);

  // send WA to admin with details (auto open WA)
  const admin = "6281296668670";
  // normalize WA buyer if starts with 0
  let waBuyer = wa || '-';
  if(/^0/.test(waBuyer)) waBuyer = waBuyer.replace(/^0/,'62');

  const waMessage =
`Halo! Saya ingin memesan Pukis:
- Nama: ${order.nama}
- Jenis: ${order.jenis}
- Topping: ${order.toppingMode}
- Rasa: ${order.singleList || '-'}
- Taburan: ${order.doubleList || '-'}
- Isi per Box: ${order.isiPerBox} pcs
- Jumlah Box: ${order.jumlahBox}
- Total: ${formatRp(order.grandTotal)}
- Invoice: ${order.invoiceID}
- WA buyer: ${waBuyer}
- Alamat: ${order.alamat || '-'}`;

  // open WA to admin; include note that pdf was downloaded (browser cannot attach file to WA automatically)
  const waUrl = `https://wa.me/${admin}?text=${encodeURIComponent(waMessage)}`;
  window.open(waUrl,'_blank');

  // Optional: show simple nota popup on screen
  const notaBox = document.getElementById('notaBox');
  if(notaBox){
    notaBox.innerHTML = `<h3>Nota: ${order.invoiceID}</h3>
      <p><strong>${order.nama}</strong> â€” ${formatRp(order.grandTotal)}</p>
      <p>Pesanan telah dibuat. PDF nota otomatis didownload. WA ke admin terbuka.</p>
      <button onclick="document.getElementById('notaContainer').style.display='none'">Tutup</button>`;
    document.getElementById('notaContainer').style.display = 'flex';
  }

  // store last order (optional)
  window._lastOrder = order;
});
</script>
    <!-- ========== PART 5: TESTIMONI, QRIS, FLOAT, FOOTER ========== -->
<!-- Testimoni -->
<section id="testimoni" class="card" style="margin-top:14px;">
  <h3>Testimoni</h3>
  <form id="testiForm" style="margin-bottom:8px;">
    <input id="testi_nama" placeholder="Nama" style="padding:6px;border-radius:6px;border:1px solid #ccc;margin-right:8px">
    <input id="testi_pesan" placeholder="Tulis testimoni..." style="padding:6px;border-radius:6px;border:1px solid #ccc;width:60%">
    <button type="button" id="testi_kirim" style="padding:6px 10px;border-radius:6px;background:#0069d9;color:#fff;border:0">Kirim</button>
  </form>
  <ul id="testi_list" style="list-style:none;padding-left:0;">
    <li><strong>Anggi, Payakumbuh</strong><br>"Pukisnya lembut dan toppingnya melimpah!"</li>
    <li><strong>Wenni, Pekanbaru</strong><br>"Rasa pandan-nya mantap!"</li>
  </ul>
</section>

<!-- QRIS -->
<div class="card" style="margin-top:14px;">
  <h3>Bayar dengan QRIS</h3>
  <p>Scan QRIS berikut dan isi nominal sesuai total pada nota.</p>
  <img src="assets/images/qris-pukis.jpg" alt="QRIS" style="max-width:180px;border-radius:8px">
</div>

<!-- Floating share icons -->
<div id="floatingIcons" style="position:fixed;right:16px;bottom:90px;display:flex;flex-direction:column;gap:10px;z-index:999;">
  <a href="https://wa.me/6281296668670" style="background:#fff;padding:10px;border-radius:8px;box-shadow:0 8px 18px rgba(0,0,0,0.12)"><i class="fa-brands fa-whatsapp"></i></a>
  <a href="https://www.instagram.com/pukis.lumer_aulia" style="background:#fff;padding:10px;border-radius:8px;box-shadow:0 8px 18px rgba(0,0,0,0.12)"><i class="fa-brands fa-instagram"></i></a>
</div>

<!-- Footer -->
<footer style="margin-top:18px;padding:12px;text-align:center;background:#222;color:#fff;border-radius:8px">
  <p>Â© 2025 Pukis Lumer Aulia â€” Hak cipta dilindungi</p>
  <p><a href="https://maps.app.goo.gl/LmM9QywPpAUUVkJ4A" target="_blank" style="color:#fff;text-decoration:underline">Lokasi di Google Maps</a></p>
</footer>

<script>
/* Testimoni simple */
document.getElementById('testi_kirim').addEventListener('click', ()=>{
  const n = document.getElementById('testi_nama').value.trim();
  const p = document.getElementById('testi_pesan').value.trim();
  if(!n||!p){ alert('Isi nama & pesan'); return; }
  const li = document.createElement('li');
  li.innerHTML = `<strong>${n}</strong><br>"${p}"`;
  document.getElementById('testi_list').insertBefore(li, document.getElementById('testi_list').firstChild);
  document.getElementById('testi_nama').value=''; document.getElementById('testi_pesan').value='';
});
</script>
   <!-- ========== PART 6: ADMIN BUTTON, FIREBASE HOOK & CLOSE ========== -->
<!-- Admin button -->
<a id="btnAdmin" href="#" style="position:fixed;left:16px;bottom:18px;background:var(--accent);color:#fff;padding:10px 14px;border-radius:8px;text-decoration:none;z-index:999">ðŸ”‘ Admin</a>

<!-- Firebase loader hook (optional) - single import only -->
<script type="module">
  // Jika kamu memakai Firebase: buat firebase.js yang mengekspor `auth` dan `getContent`.
  try {
    import { auth, getContent } from "./firebase.js";
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
    let userReady=false, currentUser=null;
    onAuthStateChanged(auth, user=>{ userReady=true; currentUser=user; });
    const btn = document.getElementById('btnAdmin');
    btn.addEventListener('click',(e)=>{ e.preventDefault(); if(!userReady){ alert('Memeriksa status login...'); return; } window.location.href = currentUser ? 'admin.html' : 'login.html'; });

    // load homepage content if any
    window.addEventListener('load', async ()=>{ try{ const data = await getContent('homepage'); if(data && data.promoImage){ const el = document.getElementById('promoImage'); if(el) el.src = data.promoImage; } }catch(e){console.warn(e);} });
  } catch(err) {
    // jika firebase.js tidak ada, fallback: tombol ke login.html biasa
    const btn = document.getElementById('btnAdmin');
    btn.addEventListener('click',(e)=>{ e.preventDefault(); window.location.href = 'login.html'; });
  }
</script>

</div><!-- .container dari part1 -->
</body>
</html> 
             
